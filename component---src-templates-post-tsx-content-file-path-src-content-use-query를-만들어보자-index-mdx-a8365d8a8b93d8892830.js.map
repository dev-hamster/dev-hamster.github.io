{"version":3,"file":"component---src-templates-post-tsx-content-file-path-src-content-use-query를-만들어보자-index-mdx-a8365d8a8b93d8892830.js","mappings":"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","sources":["webpack://blog/./src/content/useQuery를 만들어보자/index.mdx","webpack://blog/./src/templates/post.tsx","webpack://blog/./src/utils/getThumbnailImage.ts","webpack://blog/./node_modules/@mdx-js/react/lib/index.js"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h2: \"h2\",\n    p: \"p\",\n    code: \"code\",\n    ol: \"ol\",\n    li: \"li\",\n    h3: \"h3\",\n    strong: \"strong\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.h2, null, \"들어가며\"), \"\\n\", React.createElement(_components.p, null, \"React Query는 제가 애정하는 라이브러리 중 하나입니다. 데이터 패칭 상태 관리를 마법 처럼 우아하게 처리하고 캐싱을 통해 불필요한 네트워크 요청을 줄여 리소스를 절약할 수도 있습니다. 예전에는 \", React.createElement(_components.code, null, \"useEffect\"), \"로 구현했는데 반복되는 중복 코드때문에 고민이 많았던 기억이 납니다.\"), \"\\n\", React.createElement(_components.p, null, \"그런데 React Query에 너무 익숙해진 나머지, 정작 \", React.createElement(_components.code, null, \"useEffect\"), \"로 데이터 패칭을 구현하는 방법을 잊어버렸습니다. 그래서 이번에는 \", React.createElement(_components.code, null, \"useQuery\"), \" 훅을 직접 구현해보며 학습한 과정을 정리해보겠습니다.\"), \"\\n\", React.createElement(_components.h2, null, \"구현 목표\"), \"\\n\", React.createElement(_components.p, null, \"이렇게 4가지를 구현해보았습니다.\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"상태 관리: \", React.createElement(_components.code, null, \"isPending\"), \", \", React.createElement(_components.code, null, \"isError\"), \", \", React.createElement(_components.code, null, \"data\"), \" 상태를 관리\"), \"\\n\", React.createElement(_components.li, null, \"경쟁 상태 방지: 여러번의 요청이 발생해도 최신 데이터만 화면에 보여지도록 보장\"), \"\\n\", React.createElement(_components.li, null, \"캐싱: 캐싱된 데이터가 있으면 이를 우선적으로 보여주고, 데이터가 stale한 상태라면 새로운 데이터를 패치\"), \"\\n\", React.createElement(_components.li, null, \"retry 지원: 네트워크 요청 실패 시, 지정된 횟수만큼 재시도 할 수 있음\"), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"구현 과정\"), \"\\n\", React.createElement(_components.h3, null, \"1. 상태 관리\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"useEffect\"), \"를 사용해 \", React.createElement(_components.code, null, \"isPending\"), \", \", React.createElement(_components.code, null, \"isError\"), \", \", React.createElement(_components.code, null, \"data\"), \" 상태를 관리하는 기능을 구현하면서 무한 렌더링에 빠졌습니다.\"), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.code, null, \"useEffect\"), \" 로직 내부에서 \", React.createElement(_components.code, null, \"queryKey\"), \"와 \", React.createElement(_components.code, null, \"queryFn\"), \"을 참조하여 \", React.createElement(_components.code, null, \"react-hooks\"), \" 린터 규칙에 따라 의존성 배열에 두 변수를 포함해야 합니다. 하지만 \", React.createElement(_components.code, null, \"queryFn\"), \"을 포함하면 무한 렌더링이 발생합니다.\"), \"\\n\", React.createElement(_components.p, null, \"이는 \", React.createElement(_components.code, null, \"queryFn\"), \"이 리렌더링이 될때마다 \", React.createElement(_components.strong, null, \"새로운 객체로 평가\"), \"되기 때문에 무한 렌더링에 빠지게 됩니다. 그래서 이를 방지하기 위해 의존성 배열에 \", React.createElement(_components.code, null, \"queryKey\"), \"만 포함했습니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// useQuery.ts</span>\\n\\n<span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n<span class=\\\"token keyword\\\">type</span> <span class=\\\"token class-name\\\">UseQueryProps<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  queryKey<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function-variable function\\\">queryFn</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useQuery</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token punctuation\\\">,</span> TError <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  queryKey<span class=\\\"token punctuation\\\">,</span>\\n  queryFn<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">:</span> UseQueryProps<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>isPending<span class=\\\"token punctuation\\\">,</span> setIsPending<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>data<span class=\\\"token punctuation\\\">,</span> setData<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useState</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>error<span class=\\\"token punctuation\\\">,</span> setError<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useState</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TError <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">queryFn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token comment\\\">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>queryKey<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    isPending<span class=\\\"token punctuation\\\">,</span>\\n    error<span class=\\\"token punctuation\\\">,</span>\\n    data<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"2. 경쟁 상태 방지\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<span\\n      class=\\\"gatsby-resp-image-wrapper\\\"\\n      style=\\\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 786px; \\\"\\n    >\\n      <a\\n    class=\\\"gatsby-resp-image-link\\\"\\n    href=\\\"/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png\\\"\\n    style=\\\"display: block\\\"\\n    target=\\\"_blank\\\"\\n    rel=\\\"noopener\\\"\\n  >\\n    <span\\n    class=\\\"gatsby-resp-image-background-image\\\"\\n    style=\\\"padding-bottom: 35.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVR42pWRvQrCMBSF+xAOPpfPp+Ds4OKiL6CDk0i3QqE6tKX5a3KTisMxSekglKDDBzcJOZwvyYwxIM9gRyxphL1/IKJImDMiA94TKmY8hFqGAw2tfyMEtW0LxlicM+cblcxhnyvsbgznykIrCSEl5AxCiK+1UioGcs7HwFBTG0JvrIfiTAk1a21a2XnlJze4+GaBvLb+HefDpjbT5TkyvDS29wGLNbDcAKvDG64XXkFEvYmg13UdmqZJB4aGZUc4Fg6nYsD1MTbUCe3Uj38A9FQTt6sAkcYAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n  ></span>\\n  <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        alt=\\\"경쟁상태\\\"\\n        title=\\\"\\\"\\n        src=\\\"/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png\\\"\\n        srcset=\\\"/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/5a46d/race-condition.png 300w,\\n/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/0a47e/race-condition.png 600w,\\n/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png 786w\\\"\\n        sizes=\\\"(max-width: 786px) 100vw, 786px\\\"\\n        style=\\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\\"\\n        loading=\\\"lazy\\\"\\n        decoding=\\\"async\\\"\\n      />\\n  </a>\\n    </span>\"\n    }\n  }), \"\\n\", React.createElement(_components.p, null, \"만약에 동시에 여러 번의 요청이 발생했을 때 첫 번째 요청이 나중에 완료되면 두 번째 요청의 결과를 덮어씁니다.\"), \"\\n\", React.createElement(_components.p, null, \"이를 방지하기 위해 현재 컴포넌트가 활성상태인지 나타내는 \", React.createElement(_components.code, null, \"active\"), \" flag를 통해 해결할 수 있습니다.\"), \"\\n\", React.createElement(_components.p, null, \"새로운 요청이 발생할 때마다 \", React.createElement(_components.code, null, \"active\"), \"플래그를 \", React.createElement(_components.code, null, \"true\"), \"로 설정하고, 기존 요청에 대해서 클린업 함수를 실행해 \", React.createElement(_components.code, null, \"false\"), \"로 설정해 기존 요청의 결과를 무시합니다. 그러면 항상 마지막으로 요청한 요청에 대해서만 상태를 업데이트 하도록 보장할 수 있습니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// useQuery.ts</span>\\n\\n<span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">let</span> active <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleResult</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 활성 상태가 아님</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>active<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleError</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token operator\\\">:</span> TError<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 활성 상태가 아님</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>active<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">queryFn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">handleResult</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">handleError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    active <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>queryKey<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"3. retry 구현\"), \"\\n\", React.createElement(_components.p, null, \"네트워크 요청 실패 시, \", React.createElement(_components.code, null, \"MAXIMUM_RETRY\"), \"만큼 재시도하도록 재귀적으로 \", React.createElement(_components.code, null, \"fetchWithRetry\"), \"를 호출했습니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// useQuery.ts</span>\\n\\n<span class=\\\"token comment\\\">// ...</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fetchWithRetry</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">queryFn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">handleResult</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">MAXIMUM_RETRY</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">fetchWithRetry</span><span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">handleError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>retry<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">fetchWithRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">fetchWithoutRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"4. cache 구현\"), \"\\n\", React.createElement(_components.p, null, \"캐시를 관리하기 위해 싱글톤 클래스를 사용해 다른 useQuery에서도 동일한 캐시 데이터에 데이터를 저장할 수 있도록 했습니다.\"), \"\\n\", React.createElement(_components.p, null, \"queryKey를 기준으로 데이터를 저장하고 유효한 cacheTime 과 함께 데이터를 저장해 데이터를 읽었을 때 stale하다면 삭제하도록 했습니다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// queryCache.ts</span>\\n\\n<span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">CacheData<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span> <span class=\\\"token punctuation\\\">{</span>\\n  createdAt<span class=\\\"token operator\\\">:</span> Date<span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 데이터 생성 시간</span>\\n  cacheTime<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n  value<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">QueryCache<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n  <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">static</span> instance<span class=\\\"token operator\\\">:</span> QueryCache<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">private</span> cache<span class=\\\"token operator\\\">:</span> Record<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">,</span> CacheData<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">>></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">private</span> <span class=\\\"token function\\\">constructor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">static</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">getInstance</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> QueryCache<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>QueryCache<span class=\\\"token punctuation\\\">.</span>instance<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      QueryCache<span class=\\\"token punctuation\\\">.</span>instance <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">QueryCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">return</span> QueryCache<span class=\\\"token punctuation\\\">.</span>instance<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">writeCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    key<span class=\\\"token punctuation\\\">,</span>\\n    value<span class=\\\"token punctuation\\\">,</span>\\n    cacheTime<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n    value<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">;</span>\\n    cacheTime<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> value<span class=\\\"token punctuation\\\">,</span> createdAt<span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> cacheTime <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">readCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>key <span class=\\\"token keyword\\\">in</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> cachedItem <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> isStale <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">-</span> cachedItem<span class=\\\"token punctuation\\\">.</span>createdAt<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">></span>\\n        cachedItem<span class=\\\"token punctuation\\\">.</span>cacheTime<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>isStale<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// 데이터 삭제</span>\\n        <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">#deleteCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span> cachedItem<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">#deleteCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">void</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">delete</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// useQuery.ts</span>\\n\\n<span class=\\\"token comment\\\">// ...</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleResult</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// 활성 상태가 아님</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>active<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token comment\\\">// 캐시에 저장</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>cache<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    queryCache<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">writeCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> key<span class=\\\"token operator\\\">:</span> queryKey<span class=\\\"token punctuation\\\">,</span> value<span class=\\\"token operator\\\">:</span> result<span class=\\\"token punctuation\\\">,</span> cacheTime <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token comment\\\">// ...</span>\\n<span class=\\\"token keyword\\\">const</span> cachedData <span class=\\\"token operator\\\">=</span> queryCache<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">readCache</span><span class=\\\"token punctuation\\\">(</span>queryKey<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>cache <span class=\\\"token operator\\\">&amp;&amp;</span> cachedData<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>cachedData<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token keyword\\\">as</span> TData<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>retry<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">fetchWithRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">fetchWithoutRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, null, \"전체코드\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// queryCache.ts</span>\\n\\n<span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">CacheData<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span> <span class=\\\"token punctuation\\\">{</span>\\n  createdAt<span class=\\\"token operator\\\">:</span> Date<span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 데이터 생성 시간</span>\\n  cacheTime<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n  value<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">QueryCache<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n  <span class=\\\"token keyword\\\">private</span> <span class=\\\"token keyword\\\">static</span> instance<span class=\\\"token operator\\\">:</span> QueryCache<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">private</span> cache<span class=\\\"token operator\\\">:</span> Record<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">,</span> CacheData<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">>></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">private</span> <span class=\\\"token function\\\">constructor</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">static</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">getInstance</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> QueryCache<span class=\\\"token operator\\\">&lt;</span>TData<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>QueryCache<span class=\\\"token punctuation\\\">.</span>instance<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      QueryCache<span class=\\\"token punctuation\\\">.</span>instance <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">QueryCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">return</span> QueryCache<span class=\\\"token punctuation\\\">.</span>instance<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">writeCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n    key<span class=\\\"token punctuation\\\">,</span>\\n    value<span class=\\\"token punctuation\\\">,</span>\\n    cacheTime<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n    key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n    value<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">;</span>\\n    cacheTime<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> value<span class=\\\"token punctuation\\\">,</span> createdAt<span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> cacheTime <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">readCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>key <span class=\\\"token keyword\\\">in</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> cachedItem <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">const</span> isStale <span class=\\\"token operator\\\">=</span>\\n        <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Date</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">-</span> cachedItem<span class=\\\"token punctuation\\\">.</span>createdAt<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getTime</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">></span>\\n        cachedItem<span class=\\\"token punctuation\\\">.</span>cacheTime<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>isStale<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// 데이터 삭제</span>\\n        <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">#deleteCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">return</span> cachedItem<span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">null</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token function\\\">#deleteCache</span><span class=\\\"token punctuation\\\">(</span>key<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token keyword\\\">void</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">delete</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>cache<span class=\\\"token punctuation\\\">[</span>key<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"tsx\\\"><pre class=\\\"language-tsx\\\"><code class=\\\"language-tsx\\\"><span class=\\\"token comment\\\">// useQuery.ts</span>\\n\\n<span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n<span class=\\\"token keyword\\\">type</span> <span class=\\\"token class-name\\\">UseQueryProps<span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span></span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n  queryKey<span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">string</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function-variable function\\\">queryFn</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token builtin\\\">Promise</span><span class=\\\"token operator\\\">&lt;</span><span class=\\\"token constant\\\">T</span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  cache<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">boolean</span><span class=\\\"token punctuation\\\">;</span>\\n  cacheTime<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">number</span><span class=\\\"token punctuation\\\">;</span>\\n  retry<span class=\\\"token operator\\\">?</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token builtin\\\">boolean</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">MAXIMUM_RETRY</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">5</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 최대 retry 횟수</span>\\n<span class=\\\"token keyword\\\">const</span> <span class=\\\"token constant\\\">DEFAULT_CACHE_TIME</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">60</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token number\\\">1000</span><span class=\\\"token punctuation\\\">;</span> <span class=\\\"token comment\\\">// 캐시 디폴트 저장 시간, 1분</span>\\n\\n<span class=\\\"token comment\\\">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">function</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useQuery</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token punctuation\\\">,</span> TError <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">any</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n  queryKey<span class=\\\"token punctuation\\\">,</span>\\n  queryFn<span class=\\\"token punctuation\\\">,</span>\\n  cache<span class=\\\"token punctuation\\\">,</span>\\n  cacheTime <span class=\\\"token operator\\\">=</span> <span class=\\\"token constant\\\">DEFAULT_CACHE_TIME</span><span class=\\\"token punctuation\\\">,</span>\\n  retry<span class=\\\"token punctuation\\\">,</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token operator\\\">:</span> UseQueryProps<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>isPending<span class=\\\"token punctuation\\\">,</span> setIsPending<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>data<span class=\\\"token punctuation\\\">,</span> setData<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useState</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TData <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> <span class=\\\"token punctuation\\\">[</span>error<span class=\\\"token punctuation\\\">,</span> setError<span class=\\\"token punctuation\\\">]</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token generic-function\\\"><span class=\\\"token function\\\">useState</span><span class=\\\"token generic class-name\\\"><span class=\\\"token operator\\\">&lt;</span>TError <span class=\\\"token operator\\\">|</span> <span class=\\\"token keyword\\\">undefined</span><span class=\\\"token operator\\\">></span></span></span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> queryCache <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">useMemo</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> QueryCache<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getInstance</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token function\\\">useEffect</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">let</span> active <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">true</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleResult</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token operator\\\">:</span> TData<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 활성 상태가 아님</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>active<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token comment\\\">// 캐시에 저장</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>cache<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        queryCache<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">writeCache</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> key<span class=\\\"token operator\\\">:</span> queryKey<span class=\\\"token punctuation\\\">,</span> value<span class=\\\"token operator\\\">:</span> result<span class=\\\"token punctuation\\\">,</span> cacheTime <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n\\n      <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">handleError</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token operator\\\">:</span> TError<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 활성 상태가 아님</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token operator\\\">!</span>active<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">return</span><span class=\\\"token punctuation\\\">;</span>\\n\\n      <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fetchWithRetry</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">0</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">queryFn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token function\\\">handleResult</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span> <span class=\\\"token operator\\\">&lt;</span> <span class=\\\"token constant\\\">MAXIMUM_RETRY</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token function\\\">fetchWithRetry</span><span class=\\\"token punctuation\\\">(</span>retry <span class=\\\"token operator\\\">+</span> <span class=\\\"token number\\\">1</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token function\\\">handleError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> <span class=\\\"token function-variable function\\\">fetchWithoutRetry</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">queryFn</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n        <span class=\\\"token function\\\">handleResult</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">handleError</span><span class=\\\"token punctuation\\\">(</span>error <span class=\\\"token keyword\\\">as</span> TError<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token keyword\\\">const</span> cachedData <span class=\\\"token operator\\\">=</span> queryCache<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">readCache</span><span class=\\\"token punctuation\\\">(</span>queryKey<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>cache <span class=\\\"token operator\\\">&amp;&amp;</span> cachedData<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token function\\\">setData</span><span class=\\\"token punctuation\\\">(</span>cachedData<span class=\\\"token punctuation\\\">.</span>value <span class=\\\"token keyword\\\">as</span> TData<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setIsPending</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token function\\\">setError</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">undefined</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>retry<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">fetchWithRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token function\\\">fetchWithoutRetry</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n\\n    <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n      active <span class=\\\"token operator\\\">=</span> <span class=\\\"token boolean\\\">false</span><span class=\\\"token punctuation\\\">;</span>\\n    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n\\n    <span class=\\\"token comment\\\">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>queryKey<span class=\\\"token punctuation\\\">,</span> cache<span class=\\\"token punctuation\\\">,</span> cacheTime<span class=\\\"token punctuation\\\">,</span> retry<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token punctuation\\\">{</span>\\n    isPending<span class=\\\"token punctuation\\\">,</span>\\n    error<span class=\\\"token punctuation\\\">,</span>\\n    data<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/Users/jina/Documents/GitHub/dev-hamster.github.io/src/content/useQuery를 만들어보자/index.mdx\";\nimport {Link} from 'gatsby';\nimport React from 'react';\nimport {MDXProvider} from '@mdx-js/react';\nimport {Header} from 'components/Header';\nimport {Layout} from 'components/Layout';\nimport {GatsbyImage} from 'gatsby-plugin-image';\nimport {getThumbnailImage} from 'utils/getThumbnailImage';\nconst shortcodes = {\n  Link\n};\nfunction PageTemplate(_ref) {\n  let {data, children} = _ref;\n  const {frontmatter} = data.mdx;\n  const thumbnail = getThumbnailImage(frontmatter.thumbnail);\n  return React.createElement(React.Fragment, null, React.createElement(Header, null), React.createElement(Layout, null, React.createElement(MDXProvider, {\n    components: Object.assign({\n      ul: props => React.createElement(\"ul\", Object.assign({}, props, {\n        style: {\n          listStyle: 'revert'\n        }\n      })),\n      ol: props => React.createElement(\"ul\", Object.assign({}, props, {\n        style: {\n          listStyleType: 'decimal'\n        }\n      }))\n    }, shortcodes)\n  }, React.createElement(\"article\", {\n    className: \"markdown-body\"\n  }, React.createElement(\"h1\", null, frontmatter.title), thumbnail && React.createElement(\"div\", {\n    style: {\n      position: 'relative',\n      width: '100%',\n      paddingBottom: '56.25%'\n    }\n  }, React.createElement(GatsbyImage, {\n    image: thumbnail,\n    alt: frontmatter.title,\n    className: \"absolute top-0 left-0 w-full h-full object-cover\"\n  })), children))));\n}\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PageTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nconst query = \"1754812257\";\n","import { IGatsbyImageData } from 'gatsby-plugin-image';\nimport { Thumbnail } from 'types/post';\n\nexport const getThumbnailImage = (\n  thumbnail?: Thumbnail\n): IGatsbyImageData | undefined => {\n  if (!thumbnail) return;\n\n  if ('childImageSharp' in thumbnail) {\n    return thumbnail.childImageSharp.gatsbyImageData;\n  }\n  return thumbnail as IGatsbyImageData;\n};\n","/**\n * @import {MDXComponents} from 'mdx/types.js'\n * @import {Component, ReactElement, ReactNode} from 'react'\n */\n\n/**\n * @callback MergeComponents\n *   Custom merge function.\n * @param {Readonly<MDXComponents>} currentComponents\n *   Current components from the context.\n * @returns {MDXComponents}\n *   Additional components.\n *\n * @typedef Props\n *   Configuration for `MDXProvider`.\n * @property {ReactNode | null | undefined} [children]\n *   Children (optional).\n * @property {Readonly<MDXComponents> | MergeComponents | null | undefined} [components]\n *   Additional components to use or a function that creates them (optional).\n * @property {boolean | null | undefined} [disableParentContext=false]\n *   Turn off outer component context (default: `false`).\n */\n\nimport React from 'react'\n\n/** @type {Readonly<MDXComponents>} */\nconst emptyComponents = {}\n\nconst MDXContext = React.createContext(emptyComponents)\n\n/**\n * Get current components from the MDX Context.\n *\n * @param {Readonly<MDXComponents> | MergeComponents | null | undefined} [components]\n *   Additional components to use or a function that creates them (optional).\n * @returns {MDXComponents}\n *   Current components.\n */\nexport function useMDXComponents(components) {\n  const contextComponents = React.useContext(MDXContext)\n\n  // Memoize to avoid unnecessary top-level context changes\n  return React.useMemo(\n    function () {\n      // Custom merge via a function prop\n      if (typeof components === 'function') {\n        return components(contextComponents)\n      }\n\n      return {...contextComponents, ...components}\n    },\n    [contextComponents, components]\n  )\n}\n\n/**\n * Provider for MDX context.\n *\n * @param {Readonly<Props>} properties\n *   Properties.\n * @returns {ReactElement}\n *   Element.\n * @satisfies {Component}\n */\nexport function MDXProvider(properties) {\n  /** @type {Readonly<MDXComponents>} */\n  let allComponents\n\n  if (properties.disableParentContext) {\n    allComponents =\n      typeof properties.components === 'function'\n        ? properties.components(emptyComponents)\n        : properties.components || emptyComponents\n  } else {\n    allComponents = useMDXComponents(properties.components)\n  }\n\n  return React.createElement(\n    MDXContext.Provider,\n    {value: allComponents},\n    properties.children\n  )\n}\n"],"names":["_createMdxContent","props","_components","Object","assign","h2","p","code","ol","li","h3","strong","span","_provideComponents","components","React","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","shortcodes","Link","PageTemplate","_ref","data","children","frontmatter","mdx","thumbnail","getThumbnailImage","Header","Layout","MDXProvider","ul","style","listStyle","listStyleType","className","title","position","width","paddingBottom","GatsbyImage","image","alt","GatsbyMDXWrapper","GATSBY_COMPILED_MDX","childImageSharp","gatsbyImageData","emptyComponents","MDXContext","useMDXComponents","contextComponents","properties","allComponents","disableParentContext","Provider","value"],"sourceRoot":""}