"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[609],{2692:function(n,s,a){a.r(s),a.d(s,{default:function(){return y}});var t=a(1151),p=a(7294);function e(n){const s=Object.assign({h2:"h2",p:"p",code:"code",ol:"ol",li:"li",h3:"h3",strong:"strong",span:"span"},(0,t.a)(),n.components);return p.createElement(p.Fragment,null,p.createElement(s.h2,null,"들어가며"),"\n",p.createElement(s.p,null,"React Query는 제가 애정하는 라이브러리 중 하나입니다. 데이터 패칭 상태 관리를 마법 처럼 우아하게 처리하고 캐싱을 통해 불필요한 네트워크 요청을 줄여 리소스를 절약할 수도 있습니다. 예전에는 ",p.createElement(s.code,null,"useEffect"),"로 구현했는데 반복되는 중복 코드때문에 고민이 많았던 기억이 납니다."),"\n",p.createElement(s.p,null,"그런데 React Query에 너무 익숙해진 나머지, 정작 ",p.createElement(s.code,null,"useEffect"),"로 데이터 패칭을 구현하는 방법을 잊어버렸습니다. 그래서 이번에는 ",p.createElement(s.code,null,"useQuery")," 훅을 직접 구현해보며 학습한 과정을 정리해보겠습니다."),"\n",p.createElement(s.h2,null,"구현 목표"),"\n",p.createElement(s.p,null,"이렇게 4가지를 구현해보았습니다."),"\n",p.createElement(s.ol,null,"\n",p.createElement(s.li,null,"상태 관리: ",p.createElement(s.code,null,"isPending"),", ",p.createElement(s.code,null,"isError"),", ",p.createElement(s.code,null,"data")," 상태를 관리"),"\n",p.createElement(s.li,null,"경쟁 상태 방지: 여러번의 요청이 발생해도 최신 데이터만 화면에 보여지도록 보장"),"\n",p.createElement(s.li,null,"캐싱: 캐싱된 데이터가 있으면 이를 우선적으로 보여주고, 데이터가 stale한 상태라면 새로운 데이터를 패치"),"\n",p.createElement(s.li,null,"retry 지원: 네트워크 요청 실패 시, 지정된 횟수만큼 재시도 할 수 있음"),"\n"),"\n",p.createElement(s.h2,null,"구현 과정"),"\n",p.createElement(s.h3,null,"1. 상태 관리"),"\n",p.createElement(s.p,null,p.createElement(s.code,null,"useEffect"),"를 사용해 ",p.createElement(s.code,null,"isPending"),", ",p.createElement(s.code,null,"isError"),", ",p.createElement(s.code,null,"data")," 상태를 관리하는 기능을 구현하면서 무한 렌더링에 빠졌습니다."),"\n",p.createElement(s.p,null,p.createElement(s.code,null,"useEffect")," 로직 내부에서 ",p.createElement(s.code,null,"queryKey"),"와 ",p.createElement(s.code,null,"queryFn"),"을 참조하여 ",p.createElement(s.code,null,"react-hooks")," 린터 규칙에 따라 의존성 배열에 두 변수를 포함해야 합니다. 하지만 ",p.createElement(s.code,null,"queryFn"),"을 포함하면 무한 렌더링이 발생합니다."),"\n",p.createElement(s.p,null,"이는 ",p.createElement(s.code,null,"queryFn"),"이 리렌더링이 될때마다 ",p.createElement(s.strong,null,"새로운 객체로 평가"),"되기 때문에 무한 렌더링에 빠지게 됩니다. 그래서 이를 방지하기 위해 의존성 배열에 ",p.createElement(s.code,null,"queryKey"),"만 포함했습니다."),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// useQuery.ts</span>\n\n<span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n<span class="token keyword">type</span> <span class="token class-name">UseQueryProps<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  queryKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n  <span class="token function-variable function">queryFn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useQuery</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> TError <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  queryKey<span class="token punctuation">,</span>\n  queryFn<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token operator">:</span> UseQueryProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> setIsPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TError <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>queryKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    isPending<span class="token punctuation">,</span>\n    error<span class="token punctuation">,</span>\n    data<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.h3,null,"2. 경쟁 상태 방지"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 786px; "\n    >\n      <a\n    class="gatsby-resp-image-link"\n    href="/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n    <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 35.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVR42pWRvQrCMBSF+xAOPpfPp+Ds4OKiL6CDk0i3QqE6tKX5a3KTisMxSekglKDDBzcJOZwvyYwxIM9gRyxphL1/IKJImDMiA94TKmY8hFqGAw2tfyMEtW0LxlicM+cblcxhnyvsbgznykIrCSEl5AxCiK+1UioGcs7HwFBTG0JvrIfiTAk1a21a2XnlJze4+GaBvLb+HefDpjbT5TkyvDS29wGLNbDcAKvDG64XXkFEvYmg13UdmqZJB4aGZUc4Fg6nYsD1MTbUCe3Uj38A9FQTt6sAkcYAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n  ></span>\n  <img\n        class="gatsby-resp-image-image"\n        alt="경쟁상태"\n        title=""\n        src="/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png"\n        srcset="/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/5a46d/race-condition.png 300w,\n/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/0a47e/race-condition.png 600w,\n/static/f066bf3adcdfa5fe30df3a59ec8a7e4c/321ea/race-condition.png 786w"\n        sizes="(max-width: 786px) 100vw, 786px"\n        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n        loading="lazy"\n        decoding="async"\n      />\n  </a>\n    </span>'}}),"\n",p.createElement(s.p,null,"만약에 동시에 여러 번의 요청이 발생했을 때 첫 번째 요청이 나중에 완료되면 두 번째 요청의 결과를 덮어씁니다."),"\n",p.createElement(s.p,null,"이를 방지하기 위해 현재 컴포넌트가 활성상태인지 나타내는 ",p.createElement(s.code,null,"active")," flag를 통해 해결할 수 있습니다."),"\n",p.createElement(s.p,null,"새로운 요청이 발생할 때마다 ",p.createElement(s.code,null,"active"),"플래그를 ",p.createElement(s.code,null,"true"),"로 설정하고, 기존 요청에 대해서 클린업 함수를 실행해 ",p.createElement(s.code,null,"false"),"로 설정해 기존 요청의 결과를 무시합니다. 그러면 항상 마지막으로 요청한 요청에 대해서만 상태를 업데이트 하도록 보장할 수 있습니다."),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// useQuery.ts</span>\n\n<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n  <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">handleResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token operator">:</span> TData<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 활성 상태가 아님</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n    <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">handleError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> TError<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 활성 상태가 아님</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n    <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">handleResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">handleError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>queryKey<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>'}}),"\n",p.createElement(s.h3,null,"3. retry 구현"),"\n",p.createElement(s.p,null,"네트워크 요청 실패 시, ",p.createElement(s.code,null,"MAXIMUM_RETRY"),"만큼 재시도하도록 재귀적으로 ",p.createElement(s.code,null,"fetchWithRetry"),"를 호출했습니다."),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// useQuery.ts</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> <span class="token function-variable function">fetchWithRetry</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>retry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">handleResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>retry <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_RETRY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span>retry <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">handleError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  <span class="token function">fetchWithoutRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.h3,null,"4. cache 구현"),"\n",p.createElement(s.p,null,"캐시를 관리하기 위해 싱글톤 클래스를 사용해 다른 useQuery에서도 동일한 캐시 데이터에 데이터를 저장할 수 있도록 했습니다."),"\n",p.createElement(s.p,null,"queryKey를 기준으로 데이터를 저장하고 유효한 cacheTime 과 함께 데이터를 저장해 데이터를 읽었을 때 stale하다면 삭제하도록 했습니다."),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// queryCache.ts</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">CacheData<span class="token operator">&lt;</span>TData<span class="token operator">></span></span> <span class="token punctuation">{</span>\n  createdAt<span class="token operator">:</span> Date<span class="token punctuation">;</span> <span class="token comment">// 데이터 생성 시간</span>\n  cacheTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  value<span class="token operator">:</span> TData<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">QueryCache<span class="token operator">&lt;</span>TData<span class="token operator">></span></span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> QueryCache<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token keyword">private</span> cache<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CacheData<span class="token operator">&lt;</span>TData<span class="token operator">>></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">getInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> QueryCache<span class="token operator">&lt;</span>TData<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>QueryCache<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      QueryCache<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> QueryCache<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">writeCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    key<span class="token punctuation">,</span>\n    value<span class="token punctuation">,</span>\n    cacheTime<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n    value<span class="token operator">:</span> TData<span class="token punctuation">;</span>\n    cacheTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheTime <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">readCache</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> cachedItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> isStale <span class="token operator">=</span>\n        <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cachedItem<span class="token punctuation">.</span>createdAt<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span>\n        cachedItem<span class="token punctuation">.</span>cacheTime<span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>isStale<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 데이터 삭제</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#deleteCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> cachedItem<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">#deleteCache</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>\n    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// useQuery.ts</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> <span class="token function-variable function">handleResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token operator">:</span> TData<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 활성 상태가 아님</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 캐시에 저장</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    queryCache<span class="token punctuation">.</span><span class="token function">writeCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token operator">:</span> queryKey<span class="token punctuation">,</span> value<span class="token operator">:</span> result<span class="token punctuation">,</span> cacheTime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">const</span> cachedData <span class="token operator">=</span> queryCache<span class="token punctuation">.</span><span class="token function">readCache</span><span class="token punctuation">(</span>queryKey<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">&amp;&amp;</span> cachedData<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setData</span><span class="token punctuation">(</span>cachedData<span class="token punctuation">.</span>value <span class="token keyword">as</span> TData<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">fetchWithoutRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.h3,null,"전체코드"),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// queryCache.ts</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">CacheData<span class="token operator">&lt;</span>TData<span class="token operator">></span></span> <span class="token punctuation">{</span>\n  createdAt<span class="token operator">:</span> Date<span class="token punctuation">;</span> <span class="token comment">// 데이터 생성 시간</span>\n  cacheTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  value<span class="token operator">:</span> TData<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">QueryCache<span class="token operator">&lt;</span>TData<span class="token operator">></span></span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n  <span class="token keyword">private</span> <span class="token keyword">static</span> instance<span class="token operator">:</span> QueryCache<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token keyword">private</span> cache<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CacheData<span class="token operator">&lt;</span>TData<span class="token operator">>></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">private</span> <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token generic-function"><span class="token function">getInstance</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> QueryCache<span class="token operator">&lt;</span>TData<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>QueryCache<span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      QueryCache<span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> QueryCache<span class="token punctuation">.</span>instance<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">writeCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    key<span class="token punctuation">,</span>\n    value<span class="token punctuation">,</span>\n    cacheTime<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n    value<span class="token operator">:</span> TData<span class="token punctuation">;</span>\n    cacheTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> createdAt<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheTime <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">readCache</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> cachedItem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> isStale <span class="token operator">=</span>\n        <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cachedItem<span class="token punctuation">.</span>createdAt<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span>\n        cachedItem<span class="token punctuation">.</span>cacheTime<span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>isStale<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 데이터 삭제</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">#deleteCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> cachedItem<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">#deleteCache</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>\n    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",p.createElement(s.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// useQuery.ts</span>\n\n<span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n<span class="token keyword">type</span> <span class="token class-name">UseQueryProps<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  queryKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n  <span class="token function-variable function">queryFn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n  cache<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n  cacheTime<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n  retry<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">MAXIMUM_RETRY</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 최대 retry 횟수</span>\n<span class="token keyword">const</span> <span class="token constant">DEFAULT_CACHE_TIME</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// 캐시 디폴트 저장 시간, 1분</span>\n\n<span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useQuery</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> TError <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  queryKey<span class="token punctuation">,</span>\n  queryFn<span class="token punctuation">,</span>\n  cache<span class="token punctuation">,</span>\n  cacheTime <span class="token operator">=</span> <span class="token constant">DEFAULT_CACHE_TIME</span><span class="token punctuation">,</span>\n  retry<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token operator">:</span> UseQueryProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> setIsPending<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>TError <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> queryCache <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> QueryCache<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">handleResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span>result<span class="token operator">:</span> TData<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 활성 상태가 아님</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 캐시에 저장</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        queryCache<span class="token punctuation">.</span><span class="token function">writeCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span> key<span class="token operator">:</span> queryKey<span class="token punctuation">,</span> value<span class="token operator">:</span> result<span class="token punctuation">,</span> cacheTime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">setData</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">handleError</span> <span class="token operator">=</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> TError<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 활성 상태가 아님</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>active<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n      <span class="token function">setData</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">fetchWithRetry</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>retry <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">try</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">handleResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>retry <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_RETRY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span>retry <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token function">handleError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">fetchWithoutRetry</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">try</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">queryFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">handleResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">handleError</span><span class="token punctuation">(</span>error <span class="token keyword">as</span> TError<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> cachedData <span class="token operator">=</span> queryCache<span class="token punctuation">.</span><span class="token function">readCache</span><span class="token punctuation">(</span>queryKey<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">&amp;&amp;</span> cachedData<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setData</span><span class="token punctuation">(</span>cachedData<span class="token punctuation">.</span>value <span class="token keyword">as</span> TData<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsPending</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">fetchWithRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">fetchWithoutRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>queryKey<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> cacheTime<span class="token punctuation">,</span> retry<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    isPending<span class="token punctuation">,</span>\n    error<span class="token punctuation">,</span>\n    data<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code></pre></div>'}}))}var o=function(n){void 0===n&&(n={});const{wrapper:s}=Object.assign({},(0,t.a)(),n.components);return s?p.createElement(s,n,p.createElement(e,n)):e(n)},c=a(4160),u=a(4098),l=a(1858),k=a(8032),i=a(9542);const r={Link:c.rU};function d(n){let{data:s,children:a}=n;const{frontmatter:e}=s.mdx,o=(0,i.E)(e.thumbnail);return p.createElement(p.Fragment,null,p.createElement(u.h,null),p.createElement(l.A,null,p.createElement(t.Z,{components:Object.assign({ul:n=>p.createElement("ul",Object.assign({},n,{style:{listStyle:"revert"}})),ol:n=>p.createElement("ul",Object.assign({},n,{style:{listStyleType:"decimal"}}))},r)},p.createElement("article",{className:"markdown-body"},p.createElement("h1",null,e.title),o&&p.createElement("div",{style:{position:"relative",width:"100%",paddingBottom:"56.25%"}},p.createElement(k.G,{image:o,alt:e.title,className:"absolute top-0 left-0 w-full h-full object-cover"})),a))))}function y(n){return p.createElement(d,n,p.createElement(o,n))}},9542:function(n,s,a){a.d(s,{E:function(){return t}});const t=n=>{if(n)return"childImageSharp"in n?n.childImageSharp.gatsbyImageData:n}},1151:function(n,s,a){a.d(s,{Z:function(){return c},a:function(){return o}});var t=a(7294);const p={},e=t.createContext(p);function o(n){const s=t.useContext(e);return t.useMemo((function(){return"function"==typeof n?n(s):{...s,...n}}),[s,n])}function c(n){let s;return s=n.disableParentContext?"function"==typeof n.components?n.components(p):n.components||p:o(n.components),t.createElement(e.Provider,{value:s},n.children)}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-src-content-use-query를-만들어보자-index-mdx-a8365d8a8b93d8892830.js.map